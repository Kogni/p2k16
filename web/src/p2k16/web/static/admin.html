<p2k16-header active="admin"></p2k16-header>

<div class="container">
  <h1>Admin</h1>

  <h3 id="#companies">All Companies</h3>
  <div class="row">
    <div class="col-sm-12 text-right">
      <button class="btn btn-success" ng-click="ctrl.openCompanyModal($event)">Create new company</button>
    </div>
  </div>

  <table class="table">
    <thead>
    <tr>
      <th class="col-sm-3">Last updated</th>
      <th class="col-sm-4">Name</th>
      <th class="col-sm-4">Contact</th>
      <th class="col-sm-1"></th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="c in ctrl.companies">
      <td>{{ c.updatedAt | date }}</td>
      <td>
        {{ c.name }}
        <span title="Inactive" class="glyphicon glyphicon-ban-circle" ng-if="!c.active"></span>
      </td>
      <td>
        <a href="#!/admin/account/{{ c.contact }}">open contact</a>
      </td>
      <td>
        <a ng-click="ctrl.openCompanyModal($event, c)">show</a>
      </td>
    </tr>
    </tbody>
    <tfoot>
    </tfoot>
  </table>

  <h3 id="#accounts">All accounts</h3>

  <table class="table">
    <thead>
    <tr>
      <th class="col-sm-3">Last updated</th>
      <th class="col-sm-8">username</th>
      <th class="col-sm-1"></th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="account in ctrl.accounts">
      <td>{{ account.updatedAt | date }}</td>
      <td>{{ account.username }}</td>
      <td>
        <a href="#!/admin/account/{{ account.id }}">show</a>
      </td>
    </tr>
    </tbody>
  </table>

</div>

<script type="text/ng-template" id="admin/company-modal.html">
  <div class="modal-header">
    <h3 class="modal-title" ng-if="modal.company.id">Edit company</h3>
    <h3 class="modal-title" ng-if="!modal.company.id">Register company</h3>
  </div>
  <div class="modal-body ">
    <form class="form-horizontal">
      <div class="form-group">
        <label for="name" class="col-sm-2">
          Name
        </label>
        <div class="col-sm-10">
          <input class="form-control" type="text" name="email" id="name" placeholder="name"
                 ng-model="modal.company.name"/>
        </div>
      </div>
      <div class="form-group">
        <label for="contact" class="col-sm-2">
          Contact
        </label>
        <div class="col-sm-10">
          <select class="form-control" id="contact" ng-model="modal.company.contact"
                  ng-options="a.id as (a.username + ' (' + a.name + ')') for a in modal.accounts"></select>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <div class="checkbox">
            <label>
              <input type="checkbox" ng-model="modal.company.active"> Active
            </label>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-danger" type="button" ng-click="modal.cancel()">Cancel</button>
    <button class="btn btn-success" type="button" ng-click="modal.ok()">OK</button>
  </div>
</script>
